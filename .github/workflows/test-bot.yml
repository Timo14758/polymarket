name: Test Telegram Bot

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install requests
        run: pip install requests

      - name: Run bot test
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          python - << 'EOF'
          import os
          import requests

          TELEGRAM_BOT_TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")
          TELEGRAM_CHAT_ID = os.getenv("TELEGRAM_CHAT_ID")

          def send_telegram(msg: str):
              url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
              payload = {"chat_id": TELEGRAM_CHAT_ID, "text": msg}
              requests.post(url, json=payload)

          send_telegram("âœ… Testbericht: bot werkt!")
          EOF
